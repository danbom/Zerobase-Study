# 5장 HTTP와 연계하는 웹 서버

## 5.1 1대로 멀티 도메인을 가능하게 하는 가상 호스트
- 가상호스트(Virtual Host) : 웹 서버 1대에 다른 도메인을 가지고 다른 웹 사이트들을 실행
- 클라이언트가 서버에 액세스할 는 호스트 or 도메인 명으로 접근하는데 결국 도메인 명은 DNS에 의해서 IP 주소로 변환된다. 
- mond.com와 mond12.com 두개의 도메인의 경우 IP주소가 같기 때문에 때문에 DNS로 이름을 해결하면, 둘 중 어떤 액세스인지 알 수 없다.
- 구분하기 위해 도메인 명을 완전하게 포함한 URI, 또는 Host 헤더 필드 지정 필요

## 5.2 통신 중계하는 프로그램: 프록시, 게이트웨이, 터널
- HTTP는 클라이언트와 서버 이외에 통신을 중계하는 프로그램과 서버를 연계하는 것도 가능
- 중계 프로그램과 서버는 그 다음에 있는 다른 서버에 리퀘스트를 중계하고, 그 서버로부터 받은 리스폰스를 클라이언트에 반환하는 역할을 담당한다. ex) 통신 중간 기지국과 비슷하다고 비유할 수 있다.  </br></br>
    
    ### 프록시 
    서버와 클라이언트 양쪽 역할을 하는 중계 프로그램 
    - 클라이언트 --리퀘스트--> **[프록시]** --리퀘스트--> 서버
    - 서버 --리스폰스--> **[프록시]** --리스폰스--> 클라이언트</br></br>

    ### 게이트웨이
    - 다른 서버를 중계하는 서버, 클라이언트는 상대가 게이트웨이라는 것을 알지 못하는 경우도 있다.
    - 클라이언트에게 서버인척 속여 리퀘스트를 찐서버에 전달 

    ### 터널
    - 서로 떨어진 클라이언트와 서버 사이를 중계하며 접속을 주선하는 중계프로그램</br></br>

    ### 5.2.1 프록시
    <p align="center"><img  src="https://github.com/mond1219/Zerobase-Study/blob/main/%EA%B7%B8%EB%A6%BC%EC%9C%BC%EB%A1%9C%20%EB%B0%B0%EC%9A%B0%EB%8A%94%20HTTP%20%26%20Network%20Basic/HTTP%EC%99%80%20%EC%97%B0%EA%B3%84%ED%95%98%EB%8A%94%20%EC%9B%B9%20%EC%84%9C%EB%B2%84/part4img/1.PNG">
    </p> </br></br>

    - 기본 동작 : 클라이언트로부터 받은 리퀘스트를 다른 서버에 전송, URI를 변경하지 않고 서버에 전송
    - Origin Server : 리소스 본체를 가진 서버
    - 오리진 서버에서 보낸 리스폰스는 프록시 서버를 경우해서 클라이언트에 돌아온다.
    - 여러대의 프록시 서버도 가능하고 프록시 서버를 거칠때마다 Via헤더 필드에 정보를 추가한다.
    
    - 프록시 서버 사용 이유</br>  
        1. 캐시를 사용하여 네트워크 대역 등을 효율적으로 사용</br>
        2. 조직 내에 특정 웹 사이트에 대한 엑세스 제한</br>
        3. 엑세스 로그를 획득하는 정책을 철저하게 지키려는 목적</br></br></br>

    ### 캐싱 프록시(Cashing Proxy)
    - 프록시로 리스폰스를 중계할 때 프록시 서버 상에 리소스 캐시를 보존한다.
    - 프록시에 다시 같은 리소스에 리퀘스트가 온 경우, 오리진 서버 대신 캐시를 리스폰스로 되돌려 준다.</br></br>

    ### 투명 프록시(Transparent Proxy)
    - 리퀘스트와 리스폰스를 중계 할 때 메시지 변경을 하지 않는다.
    - 메시지 변경 프록시 == 비투과 프록시 </br></br></br>

    ### 5.2.2 게이트웨이
    - 프록시와 매우 유사하지만 HTTP통신과 이외의 다른 프로토콜 통신도 실행 가능
    - 클라이언트와 게이트웨이 사이를 암호화하는 등 안전하게 접속하여 통신의 안정성을 높일 수 있다.   
    ex) 게이트웨이는 데이터베이스에 접속해 SQL 쿼리를 사용해서 데이터를 얻는 곳에 이용할 수 있다.</br>쇼핑 사이트에서 신용 카드 결제 시스템 등과 연계할 때 사용 

    ### 5.2.3 터널

    - 요구에 따라서 다른 서버와의 통신 경로를 확립한다. 
    - 클라이언트는 SSL같은 암호화 통신을 통해 서버와 안전하게 통신하기 위해 사용
    - 터널 자체는 HTTP 리퀘스트를 해석하려고 하지 않는다. 리퀘스트를 그대로 다음 서버에 중계한다. 
    - 통신하고 있는 양쪽 끝의 접속이 끝어질 때 종료한다.
    - 터널을 사용하여 서버와 안전하게 통신할 수 있다. 터널 자체는 투명한 존재라 클라이언트는 너무 의식할 필요가 없다.</br>

    ### 프록시 VS 게이트웨이 VS 터널
    공통점 : 클라이언트와 오리진 서버 사이에서 중계역할 수행
    || 프록시 | 게이트웨이 | 터널 |
    | :---: | :---: |:---: | :---: |    
    | 차이점 | 리퀘스트의 URI를 변경하지 않는다.| HTTP외에 다른 프로토콜 통신 가능 | SSL과 같은 암호화 통신|

## 5.3 리소스를 보관하는 캐시 
   
- 캐시 : 프록시 서버와 클라이언트의 로컬 디스크에 보관된 리소스의 **복사본**
    
    ### 😃장점 
    -  오리진 서버에 요청하지 않기 때문에, 통신량과 통신 시간, 서버 리소스 등을 절약할 수 있다. 
    - 캐시 서버는 프록시 서버의 하나로 **캐싱 프록시**로 분류된다. 프록시가 서버로 부터 리스폰스를 중계할 때 프록시 서버 상에 리소스의 사본을 저장한다.

    ### 5.3.1 캐시에는 유효기간이 있다.
    - 캐시를 계속 사용할 수는 없다.
    - 오리진 서버에 있는 리소스가 바뀌어도, 프록시 서버는 예전 리소스를 리스폰스 할 수 있기 때문 
    - 캐시가 있더라도 클라이언트의 요구나 캐시의 유효 기간 등에 의해서 오리진 서버에 리소스의 유효성을 확인할거나 새로운 리소스를 다시 획득하러 가게 되는 경우가 있다.

    ### 5.3.2 클라이언트 측에도 캐시가 있다. 
    - 클라이언트의 브라우저에서도 캐시를 가질 수 있다. 이를 인터넷 임시 파일이라고 한다. 
    - 브라우저가 유효한 캐시를 가지고 있는 경우, 같은 리소스의 액세스는 서버의 액세스하지 않고 로컬 디스크로부터 불러온다. 
    - 클라이언트 캐시도 오래되면, 오리진 서버에 리소스의 유효성을 확인하거나 새로운 리소스를 다시 획득한다.

